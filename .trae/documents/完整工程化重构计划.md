# 完整工程化重构计划

## 目录结构创建
1. 创建目标目录结构
   ```
   app/
   └── routers/
   core/
   ├── ai/
   ├── chat/
   ├── memory/
   └── utils/
   config/
   tests/
   ```

## 文件迁移
1. 迁移配置文件：
   - `config.py` → `config/settings.py`

2. 迁移AI相关文件：
   - `ai_manager.py` → `core/ai/manager.py`
   - `siliconflow_client.py` → `core/ai/siliconflow.py`
   - 新建 `core/ai/base.py`（AIProvider抽象类）

3. 迁移聊天服务：
   - `chat_service.py` → `core/chat/service.py`

4. 迁移记忆管理：
   - `memory_manager.py` → `core/memory/manager.py`

5. 迁移主入口：
   - `main.py` → `app/main.py`（如果存在）

## 代码拆分与重构
1. **AI Provider抽象层**：
   - 创建 `core/ai/base.py`
   - 定义 `AIProvider` 抽象类，包含 `chat` 接口
   - `SiliconFlowClient` 继承该接口

2. **Router拆分**：
   - 从 `app.py` 中拆出所有路由
   - 创建 `app/routers/chat.py`（聊天相关路由）
   - 创建 `app/routers/memory.py`（记忆相关路由）
   - 创建 `app/routers/health.py`（健康检查路由）
   - `app/main.py` 只保留Flask初始化和路由注册

3. **Service Layer重构**：
   - 确保所有业务逻辑在 `core/*/service.py` 或 `manager.py` 中
   - Router层只负责参数接收与返回，不写业务逻辑

4. **依赖关系调整**：
   - Router → Service → AI Manager → AI Client
   - Router → Service → Memory Manager

## 导入路径修正
- 修正所有文件的import路径
- 确保模块间引用正确

## 测试与验证
- 确保应用可以正常启动
- 确保所有API接口正常工作
- 不改变任何现有功能、API行为、返回字段或业务语义

## 执行顺序
1. 创建目录结构
2. 迁移和重命名文件
3. 创建AIProvider抽象类
4. 重构Service层
5. 拆分Router层
6. 修正import路径
7. 测试运行